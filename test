import static org.mockito.Mockito.*;
import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.*;

import java.io.File;
import java.io.FileFilter;

public class FileTransportServiceTest {

    @Mock
    private RequestManagerDownloadConfiguration mockConfiguration;

    @Mock
    private S3Service mockS3Service;

    @Mock
    private Job mockJob;

    @Mock
    private RequestManagerCase mockRequestManagerCase;

    @Mock
    private File mockCaseFolder;

    @Mock
    private File mockRequestFolder;

    @Mock
    private File mockItemZip;

    private FileTransportService fileTransportService;

    @BeforeEach
    public void setUp() {
        MockitoAnnotations.openMocks(this);  // Initializes the mocks
        fileTransportService = new FileTransportService();
        fileTransportService.configuration = mockConfiguration;
        fileTransportService.s3Service = mockS3Service;

        // Mock the behavior of methods in RequestManagerDownloadConfiguration
        when(mockConfiguration.getCpuEnforcementGoldPath()).thenReturn("/some/path");
        when(mockConfiguration.getCpuEnforcementBucketName()).thenReturn("bucketName");
        when(mockConfiguration.getCpuEnforcementKeyName()).thenReturn("keyName");
        when(mockConfiguration.getKmsKey()).thenReturn("kmsKey");

        // Mock the behavior of RequestManagerCase and Job
        when(mockJob.getRequestManagerCase()).thenReturn(mockRequestManagerCase);
        when(mockRequestManagerCase.getCaseId()).thenReturn("123");

        // Create mock folders and files for testing
        File[] mockRequestFolders = new File[] { mockRequestFolder };
        File[] mockItemZips = new File[] { mockItemZip };

        // Mock the listFiles for directories
        when(mockCaseFolder.listFiles((FileFilter) any())).thenReturn(mockRequestFolders);

        // Mock the listFiles for files
        when(mockRequestFolder.listFiles((FileFilter) any())).thenReturn(mockItemZips);
    }

    @Test
    public void testUploadItems() {
        // Act: Call the method being tested
        fileTransportService.uploadItems(mockJob);

        // Assert: Verify the correct interactions with the mock objects
        verify(mockS3Service).uploadS3File(anyString(), anyString(), anyString(), anyString());
    }
}